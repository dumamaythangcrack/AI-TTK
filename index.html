<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>TTK Chatbot ðŸ¤–</title>
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <div class="chat-wrapper">
    <header>
      <h1>TTK Chatbot</h1>
      <p>Powered by Gemini AI</p>
    </header>

    <main id="chat-box"></main>

    <footer>
      <input type="text" id="user-input" placeholder="Nháº­p tin nháº¯n..." autocomplete="off" />
      <button id="send-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 16 16">
          <path d="M15.854.146a.5.5 0 0 0-.53-.116l-15 6a.5.5 0 0 0-.042.92l6.772 2.892 2.892 6.772a.5.5 0 0 0 .92-.042l6-15a.5.5 0 0 0-.116-.53zM6.832 8.865l-5.478-2.338 13.215-5.286-5.286 13.215-2.338-5.478 3.689-3.69a.5.5 0 0 0-.707-.707l-3.69 3.69z"/>
        </svg>
      </button>
    </footer>
  </div>

  <script>
    const input = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');
    const sendBtn = document.getElementById('send-btn');

    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    async function sendMessage() {
      const message = input.value.trim();
      if (!message) return;

      appendMessage('user', message);
      input.value = '';

      const loadingMsg = appendMessage('ai', '...');
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message})
      });
      const data = await res.json();

      loadingMsg.remove();
      typeMessage('ai', data.reply);
    }

    function appendMessage(sender, text) {
      const div = document.createElement('div');
      div.classList.add('message', sender);
      div.innerHTML = `<p>${text}</p>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
      return div;
    }

    async function typeMessage(sender, text) {
      const div = document.createElement('div');
      div.classList.add('message', sender);
      const p = document.createElement('p');
      div.appendChild(p);
      chatBox.appendChild(div);

      for (let i = 0; i < text.length; i++) {
        p.textContent += text[i];
        await new Promise(r => setTimeout(r, 15));
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }
  </script>
</body>
</html>
