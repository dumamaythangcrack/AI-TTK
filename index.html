<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TTK AI Chat - Glassmorphism Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark:#0a0a14;
  --bg-light:#f5f5f5;
  --text-dark:#e0f7ff;
  --text-light:#0d1117;
  --accent:#33ffd6;
  --accent-hover:#33e6b8;
  --accent2:#d166ff;
  --bubble-ai-dark:rgba(20,25,35,0.75);
  --bubble-user-dark:rgba(0,95,95,0.55);
  --bubble-ai-light:rgba(233,233,235,0.85);
  --bubble-user-light:rgba(75,211,127,0.8);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Share Tech Mono','Orbitron',monospace,sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
  transition:0.5s background ease;
}

/* Background subtle gradient + soft noise */
body::before{
  content:"";
  position:absolute;
  width:300%;
  height:300%;
  background: radial-gradient(circle at 30% 30%, #33ffd644, transparent),
              radial-gradient(circle at 70% 70%, #d166ff33, transparent),
              radial-gradient(circle at 50% 50%, #33fff033, transparent),
              linear-gradient(45deg, #ff00ff11, #00ffcc11, #0088ff11);
  filter: blur(200px) contrast(1.1);
  transform: translate3d(0,0,0);
  z-index:0;
}

/* Header Glassmorphism */
header{
  padding:15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background: rgba(15,15,25,0.6);
  backdrop-filter: blur(16px) saturate(180%);
  border-radius:20px;
  box-shadow: 0 4px 30px rgba(0,0,0,0.3);
  position:relative;
  z-index:1;
  transition: all 0.4s ease;
}
header span{
  font-size:0.9em;
  opacity:0.7;
  color:#ccc;
}
.mode-toggle{
  background:none;
  border:none;
  color:inherit;
  font-size:1.5em;
  cursor:pointer;
  transition:0.3s;
}
.mode-toggle:hover{
  transform:scale(1.1);
}

/* Messages container */
#messages{
  flex:1;
  overflow-y:auto;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
  z-index:1;
  position:relative;
  scroll-behavior:smooth;
}
#messages::-webkit-scrollbar{width:10px;}
#messages::-webkit-scrollbar-track{background:transparent;}
#messages::-webkit-scrollbar-thumb{
  background: linear-gradient(45deg,var(--accent),var(--accent2));
  border-radius:8px;
}

/* Message bubble Glassmorphism */
.message{
  display:flex;
  max-width:75%;
  opacity:0;
  transform:translateY(20px) scale(0.95);
  transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.4,0,0.2,1);
  position:relative;
}
.message.show{
  opacity:1;
  transform:translateY(0) scale(1);
}
.message.user{align-self:flex-end;}
.message.ai{align-self:flex-start;}

/* AI Bubble - Data Display Frame */
.bubble{
  padding:16px 20px;
  word-wrap:break-word;
  line-height:1.5;
  white-space:pre-wrap;
  display:flex;
  flex-direction:column;
  gap:8px;
  backdrop-filter:blur(16px) saturate(180%);
  background: var(--bubble-ai-dark);
  border-radius:16px;
  position:relative;
  transition:0.3s, box-shadow 0.3s;
  overflow:hidden;
  text-shadow:0 0 2px #33ffd6;
}
.user .bubble{
  background:var(--bubble-user-dark);
  color:#fff;
}

/* --- AI Bubble Specific --- */
.ai .bubble{
  padding:20px 25px;
  border-radius:16px 16px 16px 4px; /* g√≥c tr√™n tr√°i h∆°i nh·ªçn */
  background: linear-gradient(135deg, rgba(20,25,35,0.8), rgba(30,35,50,0.85));
  box-shadow:
    0 0 10px var(--accent),
    0 0 25px var(--accent2),
    inset 0 0 5px rgba(255,255,255,0.05);
  border-left: 4px solid var(--accent);
}

/* Code/Data Display inside AI bubble */
.ai .bubble pre{
  background: rgba(10,10,20,0.7);
  border-left: 4px solid var(--accent2);
  border-radius:8px;
  padding:12px 16px;
  overflow-x:auto;
  font-family:'Share Tech Mono','Orbitron',monospace;
  color:#fff;
  margin:6px 0;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
}
.ai .bubble code{
  background: rgba(0,0,0,0.2);
  border-radius:4px;
  padding:2px 6px;
  font-family:'Share Tech Mono','Orbitron',monospace;
  color:#33ffd6;
}

/* Bubble shine / subtle effect */
.bubble::before{
  content:"";
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05), transparent 70%);
  mix-blend-mode:screen;
  transition: transform 0.2s ease;
}
.bubble.glow{
  box-shadow: 0 0 15px var(--accent), 0 0 30px var(--accent2);
  transform: scale(1.03);
}

/* Avatar */
.avatar{
  width:42px;
  height:42px;
  border-radius:50%;
  margin-right:10px;
  flex-shrink:0;
  transition: transform 0.3s, box-shadow 0.3s;
}
.message.ai .avatar{background:#33ffd6 url('https://i.ibb.co/dsCLWn26/images.jpg') center/cover no-repeat;}
.message.user .avatar{background:#005f5f url('https://i.ibb.co/PsYbWjjR/png-clipart-aspria-fitness-computer-icons-user-my-account-icon-miscellaneous-monochrome-thumbnail.png') center/cover no-repeat;}
.message.ai .avatar:hover,
.message.user .avatar:hover{
  transform: scale(1.2);
  box-shadow: 0 4px 25px var(--accent2);
}

/* Chat input Glassmorphism */
.chat-input{
  display:flex;
  padding:14px;
  gap:10px;
  background: rgba(15,15,25,0.5);
  backdrop-filter: blur(16px) saturate(180%);
  border-radius:20px;
  position:relative;
  z-index:1;
}
.chat-input input[type="text"]{
  flex:1;
  padding:14px;
  border-radius:12px;
  border:none;
  background: rgba(255,255,255,0.1);
  color: #e0f7ff;
  font-family:'Share Tech Mono','Orbitron',monospace;
  font-size:1em;
  outline:none;
  transition:0.3s, box-shadow 0.3s;
}
.chat-input input[type="text"]:focus{
  box-shadow: 0 0 12px var(--accent), 0 0 20px var(--accent2);
  background: rgba(255,255,255,0.15);
}
.send-btn{
  padding:12px 22px;
  border:none;
  border-radius:12px;
  background: linear-gradient(135deg,var(--accent),var(--accent-hover));
  color:#0a0a0f;
  font-weight:bold;
  cursor:pointer;
  font-family:'Orbitron','Share Tech Mono',monospace;
  transition:0.3s, box-shadow 0.3s;
  text-shadow:0 0 2px #33ffd6;
}
.send-btn:hover{
  box-shadow:0 0 15px var(--accent),0 0 25px var(--accent2);
}
.icon-btn{
  background:none;border:none;font-size:1.5em;color:var(--accent);cursor:pointer;transition:0.3s;}
.icon-btn:hover{text-shadow:0 0 12px var(--accent),0 0 20px var(--accent2);}
.file-input{display:none;}
.image-preview{
  width:70px;height:70px;border-radius:16px;object-fit:cover;border:2px solid var(--accent);cursor:pointer;position:relative;
  transition:0.3s, box-shadow 0.3s;
}
.image-preview:hover{
  box-shadow:0 0 15px var(--accent),0 0 25px var(--accent2);
}

/* Light mode */
body.light{background:var(--bg-light);color:var(--text-light);}
body.light .ai .bubble{background:var(--bubble-ai-light);color:var(--text-light);}
body.light .user .bubble{background:var(--bubble-user-light);}
body.light .chat-input input{background:rgba(255,255,255,0.8);color:#000;}
</style>
</head>
<body>
<header>
  ü§ñ TTK AI <span>Dev by Tr·∫ßn Tu·∫•n Khang</span>
  <button class="mode-toggle" id="modeToggle">üåì</button>
</header>
<div id="messages"></div>
<div class="chat-input">
  <button class="icon-btn" id="imgBtn">üñºÔ∏è</button>
  <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
  <input type="text" id="input" placeholder="Nh·∫≠p tin nh·∫Øn ho·∫∑c m√¥ t·∫£ ·∫£nh...">
  <button id="send" class="send-btn">G·ª≠i</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
// === GI·ªÆ NGUY√äN TO√ÄN B·ªò LOGIC JS HI·ªÜN T·∫†I ===
const API_KEY="AIzaSyCrzfPbVtDLKBAsdKO31vdHysBb8JDQYUU";
const MODEL="gemini-2.0-flash";
const endpoint=`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
const messagesDiv=document.getElementById("messages");
const input=document.getElementById("input");
const sendBtn=document.getElementById("send");
const modeToggle=document.getElementById("modeToggle");
const imgBtn=document.getElementById("imgBtn");
const fileInput=document.getElementById("fileInput");
let selectedImages=[];
document.addEventListener("mousemove", e=>{
  const x = e.clientX/window.innerWidth*30;
  const y = e.clientY/window.innerHeight*30;
  document.body.style.setProperty('--bg-offset-x', `${x}px`);
  document.body.style.setProperty('--bg-offset-y', `${y}px`);
  document.querySelectorAll('.bubble').forEach(b=>{
    const rect=b.getBoundingClientRect();
    const cx=e.clientX-(rect.left+rect.width/2);
    const cy=e.clientY-(rect.top+rect.height/2);
    const dist=Math.sqrt(cx*cx+cy*cy);
    if(dist<150){b.classList.add('glow');} else {b.classList.remove('glow');}
    b.style.setProperty('--shineX', `${cx}px`);
    b.style.setProperty('--shineY', `${cy}px`);
  });
});
function renderMessageContent(text){
  const container=document.createElement("div");
  container.innerHTML=marked.parse(text);
  container.querySelectorAll('pre code').forEach(el=>hljs.highlightElement(el));
  return container;
}
function addMessage(text,sender,isTyping=false,images=[]){
  const msg=document.createElement("div");
  msg.className=`message ${sender}`;
  const avatar=document.createElement("div");
  avatar.className="avatar";
  msg.appendChild(avatar);
  const bubble=document.createElement("div");
  bubble.className="bubble";
  images.forEach(src=>{
    const img=document.createElement("img");
    img.src=src; img.className="image-preview";
    img.onclick=()=>{selectedImages=selectedImages.filter(s=>s!==src); img.remove();};
    bubble.appendChild(img);
  });
  bubble.appendChild(renderMessageContent(text));
  if(isTyping) bubble.classList.add("typing");
  msg.appendChild(bubble);
  messagesDiv.appendChild(msg);
  setTimeout(()=>msg.classList.add("show"),50);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
  return msg;
}
imgBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=()=>{selectedImages.push(reader.result); addMessage("", "user", false,[reader.result]);};
    reader.readAsDataURL(file);
  });
};
document.addEventListener("paste",e=>{
  for(let i=0;i<e.clipboardData.items.length;i++){
    if(e.clipboardData.items[i].type.indexOf("image")!==-1){
      const file=e.clipboardData.items[i].getAsFile();
      const reader=new FileReader();
      reader.onload=()=>{selectedImages.push(reader.result); addMessage("", "user", false,[reader.result]);};
      reader.readAsDataURL(file);
    }
  }
});
async function sendMessage(){
  const text=input.value.trim();
  if(!text && selectedImages.length===0) return;
  addMessage(text||"üì∑ ·∫¢nh","user",false,selectedImages);
  input.value="";
  const typingMsg=addMessage("TTK AI ƒëang g√µ...","ai",true);
  try{
    const parts=[];
    selectedImages.forEach(img=>parts.push({inline_data:{mime_type:"image/png",data:img.split(",")[1]}}));
    if(text) parts.push({text});
    const res=await fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts}]})});
    const data=await res.json();
    typingMsg.remove();
    const reply=data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ AI.";
    addMessage(reply,"ai");
  }catch(err){
    typingMsg.remove();
    addMessage("‚ùå L·ªói k·∫øt n·ªëi ho·∫∑c key kh√¥ng h·ª£p l·ªá.","ai");
  }
  selectedImages=[];
}
sendBtn.onclick=sendMessage;
input.addEventListener("keypress",e=>{if(e.key==="Enter") sendMessage();});
modeToggle.onclick=()=>document.body.classList.toggle("light");
addMessage("Xin ch√†o üëã! M√¨nh l√† **TTK AI** ‚Äì tr·ª£ l√Ω ·∫£o c·ªßa b·∫°n. H√£y g·ª≠i tin nh·∫Øn ho·∫∑c ·∫£nh ƒë·ªÉ m√¨nh gi√∫p nh√©!","ai");
</script>
</body>
</html>
