<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TTK AI Chat - Cyberpunk</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<style>
:root{
  --bg-dark:#0d1117;
  --bg-light:#f5f5f5;
  --text-dark:#c9d1d9;
  --text-light:#0d1117;
  --accent:#00c896;
  --bubble-ai-dark:#1e2228;
  --bubble-user-dark:#007c5c;
  --bubble-ai-light:#e9e9eb;
  --bubble-user-light:#4bd37f;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
  transition:0.6s;
  perspective:1000px;
}

/* H√¨nh n·ªÅn gradient 3D t∆∞∆°ng t√°c theo chu·ªôt */
body::before{
  content:"";
  position:absolute;
  width:300%;
  height:300%;
  background: radial-gradient(circle at 30% 30%, #00ff8844, transparent),
              radial-gradient(circle at 70% 70%, #00ffff33, transparent),
              radial-gradient(circle at 50% 50%, #ff00aa33, transparent),
              linear-gradient(45deg, #ff008844, #00ff8844, #0088ff33);
  filter: blur(180px);
  transform: translate3d(0,0,0);
  transition: transform 0.1s;
  z-index:0;
}

/* Header */
header{
  padding:15px 25px;
  background: rgba(22,27,34,0.9);
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #30363d;
  z-index:1;
  position:relative;
}
header span{font-size:0.9em;opacity:0.7;}
.mode-toggle{
  background:none;
  border:none;
  color:inherit;
  font-size:1.5em;
  cursor:pointer;
  transition:0.3s;
}
.mode-toggle:hover{transform:rotate(25deg);}

/* Messages */
#messages{
  flex:1;
  overflow-y:auto;
  padding:20px;
  scroll-behavior:smooth;
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:1;
  position:relative;
}
#messages::-webkit-scrollbar{width:8px;}
#messages::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px;}

/* Bubble + animation + Cyberpunk shine */
.message{
  display:flex;
  max-width:75%;
  opacity:0;
  transform:translateY(30px);
  animation:slideUp 0.5s forwards;
  position:relative;
  transition:0.3s;
}
.message.user{align-self:flex-end;justify-content:flex-end;}
.message.ai{align-self:flex-start;justify-content:flex-start;}
.bubble{
  padding:14px 18px;
  border-radius:14px;
  word-wrap:break-word;
  line-height:1.5;
  white-space:pre-wrap;
  display:flex;
  flex-direction:column;
  gap:8px;
  backdrop-filter:blur(10px);
  position:relative;
  transition:0.2s, box-shadow 0.2s, transform 0.2s;
  overflow:hidden;
}
.user .bubble{background:var(--bubble-user-dark);color:#fff;}
.ai .bubble{background:var(--bubble-ai-dark);color:var(--text-dark);}
.bubble::before{
  content:"";
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  background: radial-gradient(circle at 50% 50%, rgba(0,255,255,0.15), transparent 60%);
  mix-blend-mode:screen;
  transform:translate(0,0);
  transition: transform 0.1s;
}
.bubble.glow{
  box-shadow: 0 0 15px rgba(0,255,255,0.5),
              0 0 30px rgba(0,255,255,0.3),
              0 0 45px rgba(0,255,255,0.2);
  transform: scale(1.03);
}

.typing{font-style:italic;opacity:0.7;}
@keyframes slideUp{to{opacity:1;transform:translateY(0);}}

/* Avatar */
.avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  margin-right:10px;
  flex-shrink:0;
  box-shadow: 0 4px 15px rgba(0,255,136,0.5);
  transition: transform 0.3s, box-shadow 0.3s;
}
.message.ai .avatar{background:#00c896 url('https://i.ibb.co/7pF0g1R/robot.png') center/cover no-repeat;}
.message.user .avatar{background:#007c5c url('https://i.ibb.co/Y0w6nLc/user.png') center/cover no-repeat;}
.message.ai .avatar:hover,
.message.user .avatar:hover{
  transform: scale(1.15) rotate(-5deg);
  box-shadow: 0 6px 25px rgba(0,255,136,0.7);
}

/* Chat input */
.chat-input{
  display:flex;
  padding:14px;
  gap:10px;
  background: rgba(22,27,34,0.95);
  border-top:1px solid #30363d;
  z-index:1;
  position:relative;
}
.chat-input input[type="text"]{
  flex:1;
  padding:14px;
  border-radius:10px;
  border:1px solid #30363d;
  background: rgba(13,17,23,0.7);
  color: var(--text-dark);
  font-size:1em;
  outline:none;
  transition:0.3s;
}
.send-btn{
  padding:12px 20px;
  border:none;
  border-radius:10px;
  background: var(--accent);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
.send-btn:hover{background:#00e6a4;}
.icon-btn{background:none;border:none;font-size:1.5em;color:var(--accent);cursor:pointer;}
.file-input{display:none;}
.image-preview{
  width:70px;height:70px;border-radius:10px;object-fit:cover;border:2px solid var(--accent);cursor:pointer;position:relative;
}
.image-preview:hover::after{
  content:"‚úñ";position:absolute;top:-6px;right:-6px;background:white;color:red;border-radius:50%;font-size:0.8em;padding:0 3px;
}

body.light{background:var(--bg-light);color:var(--text-light);}
body.light .ai .bubble{background:var(--bubble-ai-light);color:var(--text-light);}
body.light .user .bubble{background:var(--bubble-user-light);}
body.light .chat-input input{background:#fff;color:#000;}
</style>
</head>
<body>
<header>
  ü§ñ TTK AI <span>Dev by Tr·∫ßn Tu·∫•n Khang</span>
  <button class="mode-toggle" id="modeToggle">üåì</button>
</header>
<div id="messages"></div>
<div class="chat-input">
  <button class="icon-btn" id="imgBtn">üñºÔ∏è</button>
  <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
  <input type="text" id="input" placeholder="Nh·∫≠p tin nh·∫Øn ho·∫∑c m√¥ t·∫£ ·∫£nh...">
  <button id="send" class="send-btn">G·ª≠i</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>
const API_KEY="AIzaSyCrzfPbVtDLKBAsdKO31vdHysBb8JDQYUU";
const MODEL="gemini-2.0-flash";
const endpoint=`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;

const messagesDiv=document.getElementById("messages");
const input=document.getElementById("input");
const sendBtn=document.getElementById("send");
const modeToggle=document.getElementById("modeToggle");
const imgBtn=document.getElementById("imgBtn");
const fileInput=document.getElementById("fileInput");
let selectedImages=[];

// Gradient 3D, bubble shine & glow theo chu·ªôt
document.addEventListener("mousemove", e=>{
  const x = e.clientX/window.innerWidth*30;
  const y = e.clientY/window.innerHeight*30;
  document.body.style.setProperty('--bg-offset-x', `${x}px`);
  document.body.style.setProperty('--bg-offset-y', `${y}px`);
  document.body.querySelector('::before')?.style && (document.body.querySelector('::before').style.transform = `translate3d(${-x}px, ${-y}px,0)`);

  document.querySelectorAll('.bubble').forEach(b=>{
    const rect=b.getBoundingClientRect();
    const cx=e.clientX-(rect.left+rect.width/2);
    const cy=e.clientY-(rect.top+rect.height/2);
    const dist=Math.sqrt(cx*cx+cy*cy);
    if(dist<150){b.classList.add('glow');} else {b.classList.remove('glow');}
    b.style.setProperty('--shineX', `${cx}px`);
    b.style.setProperty('--shineY', `${cy}px`);
    b.querySelector('::before')?.style && (b.querySelector('::before').style.transform=`translate(${cx*0.05}px,${cy*0.05}px)`);
  });
});

function renderMessageContent(text){
  const container=document.createElement("div");
  container.innerHTML=marked.parse(text);
  container.querySelectorAll('pre code').forEach(el=>hljs.highlightElement(el));
  return container;
}

function addMessage(text,sender,isTyping=false,images=[]){
  const msg=document.createElement("div");
  msg.className=`message ${sender}`;
  const avatar=document.createElement("div");
  avatar.className="avatar";
  msg.appendChild(avatar);
  const bubble=document.createElement("div");
  bubble.className="bubble";

  images.forEach(src=>{
    const img=document.createElement("img");
    img.src=src; img.className="image-preview";
    img.onclick=()=>{selectedImages=selectedImages.filter(s=>s!==src); img.remove();}
    bubble.appendChild(img);
  });
  bubble.appendChild(renderMessageContent(text));
  if(isTyping) bubble.classList.add("typing");
  msg.appendChild(bubble);
  messagesDiv.appendChild(msg);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
  return msg;
}

imgBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=()=>{selectedImages.push(reader.result); addMessage("", "user", false,[reader.result]);};
    reader.readAsDataURL(file);
  });
};
document.addEventListener("paste",e=>{
  for(let i=0;i<e.clipboardData.items.length;i++){
    if(e.clipboardData.items[i].type.indexOf("image")!==-1){
      const file=e.clipboardData.items[i].getAsFile();
      const reader=new FileReader();
      reader.onload=()=>{selectedImages.push(reader.result); addMessage("", "user", false,[reader.result]);};
      reader.readAsDataURL(file);
    }
  }
});

async function sendMessage(){
  const text=input.value.trim();
  if(!text && selectedImages.length===0) return;
  addMessage(text||"üì∑ ·∫¢nh","user",false,selectedImages);
  input.value="";
  const typingMsg=addMessage("TTK AI ƒëang g√µ...","ai",true);
  try{
    const parts=[];
    selectedImages.forEach(img=>parts.push({inline_data:{mime_type:"image/png",data:img.split(",")[1]}}));
    if(text) parts.push({text});
    const res=await fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts}]})});
    const data=await res.json();
    typingMsg.remove();
    const reply=data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ AI.";
    addMessage(reply,"ai");
  }catch(err){
    typingMsg.remove();
    addMessage("‚ùå L·ªói k·∫øt n·ªëi ho·∫∑c key kh√¥ng h·ª£p l·ªá.","ai");
  }
  selectedImages=[];
}

sendBtn.onclick=sendMessage;
input.addEventListener("keypress",e=>{if(e.key==="Enter") sendMessage();});
modeToggle.onclick=()=>document.body.classList.toggle("light");

addMessage("Xin ch√†o üëã! M√¨nh l√† **TTK AI** ‚Äì tr·ª£ l√Ω ·∫£o c·ªßa b·∫°n. H√£y g·ª≠i tin nh·∫Øn ho·∫∑c ·∫£nh ƒë·ªÉ m√¨nh gi√∫p nh√©!","ai");
</script>
</body>
</html>
